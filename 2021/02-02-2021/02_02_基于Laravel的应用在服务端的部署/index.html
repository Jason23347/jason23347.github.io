<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Write an awesome description for your new site here. You can edit this
line in _config.yml. It will appear in your document head meta (for
Google search results) and in your feed.xml site description.
"><meta name="keyword" content=""><link rel="shortcut icon" href="/img/favicon.ico"><title>基于Laravel的应用在服务端的部署 - undefined</title><link rel="stylesheet" href="/css/aircloud.css"><link rel="stylesheet" href="/css/gitment.css"><link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet"><script></script><style>body hl:after{content:' ';display:inline;font-family:Arial;font-size:.89em}html .tag-list-item hl,html code hl,html kbd hl,html pre hl,html ruby hl,html samp hl{display:none}html ol>hl,html ul>hl{display:none}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Jason's Simple Blog" type="application/atom+xml"></head><body><div class="site-nav-toggle" id="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><div class="index-about"><i></i></div><div class="index-container"><div class="index-left"><div class="nav" id="nav"><div class="avatar-name"><div class="avatar"><img src="///gravatar.com/avatar/fdaf3db072f81d12d1a1d8edb8b269ab?s=100"></div><div class="name"><i>Jason23347</i></div></div><div class="contents" id="nav-content"><ul><li><a href="/"><i class="iconfont icon-shouye1"></i> <span><hl></hl>主页</span></a></li><li><a href="/tags"><i class="iconfont icon-biaoqian1"></i> <span>标签</span></a></li><li><a href="/archive"><i class="iconfont icon-guidang2"></i> <span>存档</span></a></li><li><a href="/about/"><i class="iconfont icon-guanyu2"></i> <span>关于</span></a></li><li><a id="search"><i class="iconfont icon-sousuo1"></i> <span>搜索</span></a></li></ul></div><div id="toc" class="toc-article"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83"><span class="toc-text">服务器环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C"><span class="toc-text">前置工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEapache"><span class="toc-text"><hl></hl>配置<hl></hl>Apache</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEvirtualhost"><span class="toc-text"><hl></hl>配置<hl></hl>VirtualHost</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E7%94%A8virtualhost"><span class="toc-text"><hl></hl>启用<hl></hl>VirtualHost</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E7%94%A8apache%E6%A8%A1%E5%9D%97"><span class="toc-text"><hl></hl>启用<hl></hl>Apache<hl></hl>模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%BE%91apache%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE"><span class="toc-text"><hl></hl>编辑<hl></hl>apache<hl></hl>全局设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%90%AF-apache-%E6%9C%8D%E5%8A%A1"><span class="toc-text">重启 Apache 服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmysql"><span class="toc-text"><hl></hl>配置<hl></hl>MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E6%88%B7"><span class="toc-text"><hl></hl>生成管理员用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">添加数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEpostgresql"><span class="toc-text"><hl></hl>配置<hl></hl>PostgreSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85php%E9%A9%B1%E5%8A%A8"><span class="toc-text"><hl></hl>安装<hl></hl>PHP<hl></hl>驱动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E6%88%B7"><span class="toc-text">创建管理员用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">创建数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEphp"><span class="toc-text"><hl></hl>配置<hl></hl>PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85composer"><span class="toc-text"><hl></hl>安装<hl></hl>Composer<hl></hl></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#composer%E6%8D%A2%E6%BA%90%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="toc-text">Composer<hl></hl>换源与安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AElaravel"><span class="toc-text"><hl></hl>配置<hl></hl>Laravel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dot-env"><span class="toc-text">DOT ENV</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%9D%83%E9%99%90"><span class="toc-text"><hl></hl>目录权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="toc-text">数据库迁移</span></a></li></ol></li></ol></div></div><div class="search-field" id="search-field"><div class="search-container"><div class="search-input"><span id="esc-search"><i class="icon-fanhui iconfont"></i></span> <input id="search-input"> <span id="begin-search">搜索</span></div><div class="search-result-container" id="search-result-container"></div></div></div><div class="index-about-mobile"><i><hl></hl></i></div></div><div class="index-middle"><div class="post-container"><div class="post-title">基于<hl></hl>Laravel<hl></hl>的应用在服务端的部署</div><div class="post-meta"><span class="attr">发布于：<span>2021-02-02 00:21:14</span></span> <span class="attr"><hl></hl>标签：/ <a class="tag" href="/tags/#sql" title="sql">sql</a> <span>/</span> <a class="tag" href="/tags/#coding" title="coding">coding</a> <span>/</span> </span><span class="attr"><hl></hl>访问：<span id="busuanzi_value_page_pv"></span></span></div><div class="post-content"><blockquote><p>一个已经去世的应用重获新生，需要在服务端重新部署，因此就有了这篇文章。</p></blockquote><h3 id="服务器环境">服务器环境</h3><ul><li>系统：Ubuntu 20.04</li><hl></hl><li>CPU：4<hl></hl>核 Intel(R) Xeon(R) Gold 6278C CPU @ 2.60GHz</li><li>内存：8G</li></ul><h3 id="前置工作">前置工作</h3><hl></hl><p>Ubuntu 20.04<hl></hl>只有<hl></hl>php7.2，但我至少需要<hl></hl>php7.4，因此先更新<hl></hl>php<hl></hl>源：</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ondrej/php</span><br></pre></td></tr></tbody></table></figure><p><hl></hl>然后安装<hl></hl>HTTP<hl></hl>服务器、Mysql、PHP、以及<hl></hl>Laravel<hl></hl>的一些依赖。</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt install apache2 \</span><br><span class="line">    mysql-server \</span><br><span class="line">    php7.4 \</span><br><span class="line">    libapache2-mod-php7.4 \</span><br><span class="line">    php7.4-mysql \</span><br><span class="line">    php7.4-opcache php7.4-mbstring \</span><br><span class="line">    php-ssh2 php-tokenizer \</span><br><span class="line">    php7.4-xml php7.4-json \</span><br><span class="line">    php7.4-bcmath php7.4-zip \</span><br><span class="line">    php7.4-curl php7.4-gd</span><br></pre></td></tr></tbody></table></figure><p></p><p>将项目文件解压到<hl></hl><code>/var/www/</code><hl></hl>目录下</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">unzip finelyteam.zip</span><br><span class="line">sudo mv finelyteam /var/www/finelyteam</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="配置apache"><hl></hl>配置<hl></hl>Apache</h3><h4 id="配置virtualhost"><hl></hl>配置<hl></hl>VirtualHost</h4><p><hl></hl>配置<hl></hl>Apache<hl></hl>网站文件<hl></hl><code>/etc/apache2/sites-available/finelyteam.conf</code>：</p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">	<span class="attribute">ServerAdmin</span> root@localhost</span><br><span class="line">	<span class="attribute"><span class="nomarkup">ServerName</span></span> dev.finely-team.com</span><br><span class="line">	<span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /var/www/finelyteam/public</span><br><span class="line"></span><br><span class="line">	<span class="attribute">ErrorLog</span> <span class="variable">${APACHE_LOG_DIR}</span>/error.finely-team.log</span><br><span class="line">	<span class="attribute">CustomLog</span> <span class="variable">${APACHE_LOG_DIR}</span>/access.finely-team.log combined</span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="启用virtualhost"><hl></hl>启用<hl></hl>VirtualHost</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo a2ensite finelyteam.conf</span><br></pre></td></tr></tbody></table></figure><h4 id="启用apache模块"><hl></hl>启用<hl></hl>Apache<hl></hl>模块</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo a2enmod php7.4 ssl rewrite</span><br></pre></td></tr></tbody></table></figure><h4 id="编辑apache全局设置"><hl></hl>编辑<hl></hl>apache<hl></hl>全局设置</h4><p>编辑文件<hl></hl><code>/etc/apache2/apache2.conf</code>，注意<hl></hl><code>AllowOverride</code><hl></hl>选项变更为<hl></hl><code>all</code></p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory /var/www/&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">	<span class="attribute">AllowOverride</span> <span class="literal">all</span></span><br><span class="line">	<span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="重启-apache-服务">重启 Apache 服务</h4><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">sudo service apache2 restart</span><br></pre></td></tr></tbody></table></figure><h3 id="配置mysql"><hl></hl>配置<hl></hl>MySQL</h3><h4 id="生成管理员用户">生成管理员用户</h4><p><hl></hl>为了让<hl></hl>PHP<hl></hl>访问数据库，我们需要生成一个<hl></hl>MySQL<hl></hl>用户。 MySQL<hl></hl>初始只允许<hl></hl>root<hl></hl>免密登录。这是不安全的，而且<hl></hl>Laravel<hl></hl>应用无法使用这个账户。</p><p><hl></hl>在<hl></hl>MySQL cli<hl></hl>里执行以下指令以生成用户并赋予所有权限。</p><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> laravel_admin<span class="variable">@localhost</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'password'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span> . <span class="operator">*</span> <span class="keyword">TO</span> laravel_admin<span class="variable">@localhost</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure><h4 id="添加数据库">添加数据库</h4><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE finelyteam;</span><br></pre></td></tr></tbody></table></figure><h3 id="配置postgresql"><hl></hl>配置<hl></hl>PostgreSQL</h3><h4 id="安装php驱动"><hl></hl>安装<hl></hl>PHP<hl></hl>驱动</h4><p><hl></hl>如果你安装的不是<hl></hl>mysql<hl></hl>而是<hl></hl>pgsql，则需要安装<hl></hl>php<hl></hl>驱动：</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt install php7.4-pgsql</span><br></pre></td></tr></tbody></table></figure><p></p><p><hl></hl>进入<hl></hl>cli<hl></hl>时不能使用<hl></hl>root<hl></hl>用户，只能使用特定用户：<code>postgres</code></p><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">su postgres</span><br><span class="line">psql</span><br></pre></td></tr></tbody></table></figure><h4 id="创建管理员用户">创建管理员用户</h4><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">create user laravel_admin superuser password '123456';</span><br></pre></td></tr></tbody></table></figure><h4 id="创建数据库">创建数据库</h4><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE laravel;</span><br></pre></td></tr></tbody></table></figure><h3 id="配置php"><hl></hl>配置<hl></hl>PHP</h3><h4 id="安装composer"><hl></hl>安装<hl></hl>Composer</h4><hl></hl><p>Composer<hl></hl>是<hl></hl>PHP<hl></hl>的包管理工具。</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get remove composer <hl></hl><span class="comment"># 不要使用 Ubuntu 库中的<hl></hl>Composer</span></span><br><span class="line"><span class="built_in">cd</span> <span class="comment"># 回家<hl></hl></span></span><br><span class="line">curl -sS https://getcomposer.org/installer | php</span><br><span class="line">mv ./composer.phar /usr/<span class="built_in">local</span>/bin/composer</span><br><span class="line"><span class="comment"># 如果提示 'Failed to decode zlib stream' 则执行</span></span><br><span class="line"><span class="comment"># sudo apt install zlib</span></span><br></pre></td></tr></tbody></table></figure><hl></hl><h4 id="composer换源与安装">Composer<hl></hl>换源与安装</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/ <span class="comment"># 切换国内 Composer 镜像<hl></hl></span></span><br><span class="line"><span class="built_in">cd</span> /var/www/finelyteam</span><br><span class="line">composer update <span class="comment"># 自动安装</span></span><br></pre></td></tr></tbody></table></figure><h3 id="配置laravel"><hl></hl>配置<hl></hl>Laravel</h3><h4 id="dot-env">DOT ENV</h4><p><hl></hl>现在来到<hl></hl>Laravel<hl></hl>项目的文件夹下，先生成<code>.env</code><hl></hl>文件。</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www/finelyteam</span><br><span class="line">mv .env.example .env</span><br><span class="line">php artisan key:generate <span class="comment"># 生成 APP KEY</span></span><br></pre></td></tr></tbody></table></figure><p><hl></hl>如果之前使用的是<hl></hl>pgsql，则需要修改数据库连接，尤其是端口：</p><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">DB_CONNECTION=pgsql</span><br><span class="line">DB_HOST=127.0.0.1</span><br><span class="line">DB_PORT=5432</span><br><span class="line">DB_DATABASE=laravel</span><br><span class="line">DB_USERNAME=laravel_admin</span><br></pre></td></tr></tbody></table></figure><h4 id="目录权限">目录权限</h4><p>为以下目录分配权限以保证访问正常。</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo chmod -R 777 public storage bootstrap/cache</span><br></pre></td></tr></tbody></table></figure><h4 id="数据库迁移">数据库迁移</h4><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">php artisan migrate --seed</span><br></pre></td></tr></tbody></table></figure><p>All done.</p><br><div id="comment-container"></div><div id="disqus_thread"></div><div id="lv-container"></div></div></div></div></div><footer class="footer"><ul class="list-inline text-center"><li><a target="_blank" href="https://github.com/Jason23347"><span class="fa-stack fa-lg"><i class="iconfont icon-github"></i></span></a></li></ul><p><span id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv"></span>PV </span><span id="busuanzi_container_site_uv"><span id="busuanzi_value_site_uv"></span>UV </span>Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p></footer><script>window.hexo_search_path="search.json",window.hexo_root="/",window.isPost=!0</script><script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><script src="/js/index.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>